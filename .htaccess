# ========================================
# ZAPX - Configura√ß√µes Apache
# Autor: Dante Testa (https://dantetesta.com.br)
# Data: 2025-10-26 07:55:00
# Vers√£o: 2.0.0
# ========================================

# ========================================
# ANTI-CACHE - CR√çTICO PARA DESENVOLVIMENTO
# ========================================

<IfModule mod_headers.c>
    # Desabilitar cache completamente para PHP
    <FilesMatch "\.(php)$">
        Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
    
    # Cache controlado para assets est√°ticos
    <FilesMatch "\.(js|css)$">
        Header set Cache-Control "no-cache, must-revalidate, max-age=0"
        Header set Pragma "no-cache"
    </FilesMatch>
    
    # Prevenir cache de AJAX/JSON
    <FilesMatch "\.(json)$">
        Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
</IfModule>

# ========================================
# CONFIGURA√á√ïES DE UPLOAD
# ========================================

# Limites do WhatsApp API
# Imagens: 5MB | V√≠deos/Docs/√Åudio: 16MB
# Configurando com margem de seguran√ßa

# Tamanho m√°ximo de arquivo individual
php_value upload_max_filesize 20M

# Tamanho m√°ximo do POST (deve ser maior que upload_max_filesize)
php_value post_max_size 25M

# Tempo m√°ximo de execu√ß√£o (5 minutos para uploads grandes)
php_value max_execution_time 300

# Tempo m√°ximo para receber dados (5 minutos)
php_value max_input_time 300

# Mem√≥ria dispon√≠vel para o script
php_value memory_limit 256M

# Habilitar uploads de arquivo
php_flag file_uploads On

# N√∫mero m√°ximo de arquivos por upload
php_value max_file_uploads 20

# ========================================
# SEGURAN√áA
# ========================================

# Desabilitar listagem de diret√≥rios
Options -Indexes

# Proteger arquivos sens√≠veis
<FilesMatch "^(\.env|\.git|config\.php|installed\.lock)">
    Order allow,deny
    Deny from all
</FilesMatch>

# üîí SEGURAN√áA: Headers de Seguran√ßa
<IfModule mod_headers.c>
    # Content Security Policy
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com https://www.google.com https://www.gstatic.com https://use.typekit.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://use.typekit.net; font-src 'self' data: https://cdnjs.cloudflare.com https://fonts.gstatic.com https://use.typekit.net; img-src 'self' data: https: blob:; media-src 'self' blob:; connect-src 'self'; frame-src 'self' https://www.google.com; object-src 'none'; base-uri 'self'; form-action 'self';"
    
    # X-Frame-Options - Previne Clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # X-Content-Type-Options - Previne MIME sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # X-XSS-Protection - Prote√ß√£o XSS do navegador
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer-Policy - Controla informa√ß√µes de refer√™ncia
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Permissions-Policy - Controla recursos do navegador
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    
    # üîí SEGURAN√áA: CORS - Controle de acesso cross-origin
    # Permitir apenas requisi√ß√µes do pr√≥prio dom√≠nio
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    Header always set Access-Control-Max-Age "3600"
</IfModule>

RewriteEngine On
RewriteBase /

# Redirecionar para HTTPS (opcional, descomente se necess√°rio)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirecionar todas as requisi√ß√µes para index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]
